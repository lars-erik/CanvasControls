<!DOCTYPE html>
<html>
<head>
	<title></title>
	
	<script src="Scripts/class.js" type="text/javascript"></script>
	<script src="Scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="Scripts/canvascontrols.js" type="text/javascript"></script>
	<script src="Scripts/canvascontrols.observable.js" type="text/javascript"></script>
	<script src="Scripts/canvascontrols.shape.js" type="text/javascript"></script>
	<script src="Scripts/canvascontrols.canvasview.js" type="text/javascript"></script>
	<script src="Scripts/canvascontrols.dragging.js" type="text/javascript"></script>
	<script src="Scripts/canvascontrols.timeline.tree.js" type="text/javascript"></script>

	<style type="text/css">
			
	.menu {
		position: absolute;
		width: 100px;
		height: 100px;
		border: 1px solid black;
		background-color: #ECECEC;
		display: none;
	}
		
	</style>
</head>
<body>
	
	<canvas id="tree" style="position:absolute; width:100%;height:600px;"></canvas>
	<canvas id="dragView" style="position:absolute; width:100%;height:600px;"></canvas>
	
	<div id="menu" class="menu">
		<span id="add">add</span><br/>
		<span id="remove">remove</span><br/>
	</div>

	<script type="text/javascript">

		var canvasView = new canvascontrols.CanvasView("#tree");
		var dragView = new canvascontrols.DragView("#dragView");
		var tree = new canvascontrols.TimelineTree();
		var box1 = new canvascontrols.TimelineTreeNode({
			label: "Boks 1"
		});
		var box2 = new canvascontrols.TimelineTreeNode({
			label: "Boks 2"
		});
		var childBox11 = new canvascontrols.TimelineTreeNode({
			label: "Boks 1.1"
		});
		var childBox12 = new canvascontrols.TimelineTreeNode({
			label: "Boks 1.2"
		});
		var childBox21 = new canvascontrols.TimelineTreeNode({
			label: "Boks 2.1"
		});
		var grandChildBox111 = new canvascontrols.TimelineTreeNode({
			label: "Boks 1.1.1"
		});
		var grandChildBox112 = new canvascontrols.TimelineTreeNode({
			label: "Boks 1.1.2"
		});
		box1.add(childBox11);
		box1.add(childBox12);
		box2.add(childBox21);
		childBox11.add(grandChildBox111);
		childBox11.add(grandChildBox112);
		tree.add(box1);
		tree.add(box2);
		canvasView.add(tree);

		var obj = new Object();
//		tree.on("toggled.cc nodeRemoved.cc nodeAdded.cc", obj, repaint);

		canvasView.paint();

		var currentNode;

		tree.on("contextmenu", {}, function (s, e) {
			$("#menu").hide();
			currentNode = e.child;
			$("#menu").css("left", e.pageX);
			$("#menu").css("top", e.pageY);
			$("#menu").show();
			e.preventDefault();
		});

		tree.on("toggled.cc nodeAdded.cc nodeRemoved.cc", {}, function () {
			canvasView.paint();
		});

		tree.on("mousedown", {}, function (s, e) {
			if (e.child != null) {
				var height = e.child.getHeight();
				var coords = {
					x: e.child.globalX() + tree.x() + e.child._boxX,
					y: e.child.globalY() + tree.y(),
					w: e.child._width,
					h: height > 50 ? 50 : height
				};
				var shape = canvascontrols.DragShape.create(
					canvasView.context,
					coords.x, coords.y, coords.w, coords.h
				);
				dragView.startDrag(shape, coords.x, coords.y);
			}
		});

		$("#add").click(function () {
			currentNode.add(new canvascontrols.TimelineTreeNode());
			$("#menu").hide();
		});

		$("#remove").click(function () {
			currentNode._parent.remove(currentNode);
			$("#menu").hide();
		});

	</script>
</body>
</html>
